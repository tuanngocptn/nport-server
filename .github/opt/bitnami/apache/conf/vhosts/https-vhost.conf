<VirtualHost *:443>
    ServerName nport.link
    SSLEngine on
    SSLCertificateFile "/opt/bitnami/apache/conf/certs/nport.link.crt"
    SSLCertificateKeyFile "/opt/bitnami/apache/conf/certs/nport.link.key"

    # Secure SSL Protocols and Ciphers
    SSLProtocol TLSv1 TLSv1.1 TLSv1.2
    SSLHonorCipherOrder On
    SSLCipherSuite ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-AES256-GCM-SHA384:DHE-RSA-AES128-GCM-SHA256:DHE-DSS-AES128-GCM-SHA256:kEDH+AESGCM:ECDHE-RSA-AES128-SHA256:ECDHE-ECDSA-AES128-SHA256:ECDHE-RSA-AES128-SHA:ECDHE-ECDSA-AES128-SHA:ECDHE-RSA-AES256-SHA384:ECDHE-ECDSA-AES256-SHA384:ECDHE-RSA-AES256-SHA:ECDHE-ECDSA-AES256-SHA:DHE-RSA-AES128-SHA256:DHE-RSA-AES128-SHA:DHE-DSS-AES128-SHA256:DHE-RSA-AES256-SHA256:DHE-DSS-AES256-SHA:DHE-RSA-AES256-SHA:ECDHE-RSA-DES-CBC3-SHA:ECDHE-ECDSA-DES-CBC3-SHA:AES128-GCM-SHA256:AES256-GCM-SHA384:AES128-SHA256:AES256-SHA256:AES128-SHA:AES256-SHA:AES:CAMELLIA:DES-CBC3-SHA:!aNULL:!eNULL:!EXPORT:!DES:!RC4:!MD5:!PSK:!aECDH:!EDH-DSS-DES-CBC3-SHA:!EDH-RSA-DES-CBC3-SHA:!KRB5-DES-CBC3-SHA

    # SSLSessionCache "shmcb:/opt/bitnami/apache/logs/ssl_scache(512000)"
    # SSLSessionCache shared:SSL:10m
    # SSLSessionTimeout 1800

    # Enable HTTP/2
    Protocols h2 http/1.1

    # Proxy settings
    ProxyPreserveHost On
    ProxyRequests Off

    # Headers
    RequestHeader set X-Real-IP %{REMOTE_ADDR}s
    RequestHeader set X-Forwarded-For %{REMOTE_ADDR}s
    RequestHeader set Host %{HTTP_HOST}s
    RequestHeader set X-Forwarded-Proto https
    RequestHeader set X-NginX-Proxy true
    RequestHeader set Upgrade %{HTTP:Upgrade}e
    RequestHeader set Connection %{HTTP:Connection}e

    # WebSocket proxying
    RewriteEngine On
    RewriteCond %{HTTP:Upgrade} websocket [NC]
    RewriteCond %{HTTP:Connection} upgrade [NC]
    RewriteRule ^/(.*) wss://localhost:3000/$1 [P,L]

    # Regular HTTP proxying (only if WebSocket conditions are not met)
    ProxyPass / http://localhost:3000/
    ProxyPassReverse / http://localhost:3000/
</VirtualHost>